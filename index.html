<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard T·ªëi ∆∞u Hi·ªáu nƒÉng Spark Streaming</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: T√¥i ƒë√£ thi·∫øt k·∫ø ·ª©ng d·ª•ng n√†y theo c·∫•u tr√∫c ba ph·∫ßn theo ch·ªß ƒë·ªÅ ƒë·ªÉ t·ªëi ∆∞u h√≥a tr·∫£i nghi·ªám ng∆∞·ªùi d√πng. Ph·∫ßn 1 ("C√°c Y·∫øu T·ªë ·∫¢nh H∆∞·ªüng") s·ª≠ d·ª•ng c√°c th·∫ª t∆∞∆°ng t√°c ƒë·ªÉ ng∆∞·ªùi d√πng kh√°m ph√° c√°c nguy√™n nh√¢n g·ªëc r·ªÖ ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu nƒÉng. Ph·∫ßn 2 ("Gi√°m S√°t & ƒêo L∆∞·ªùng") s·ª≠ d·ª•ng bi·ªÉu ƒë·ªì t∆∞∆°ng t√°c ƒë·ªÉ tr·ª±c quan h√≥a m·ªëi quan h·ªá gi·ªØa c√°c ch·ªâ s·ªë quan tr·ªçng (Processing Time v√† Scheduling Delay). Ph·∫ßn 3 ("Demo & Th·ª±c H√†nh") s·ª≠ d·ª•ng giao di·ªán tab ƒë·ªÉ so s√°nh c√°c k·ªãch b·∫£n kh√°c nhau, gi√∫p ng∆∞·ªùi d√πng th·∫•y r√µ t√°c ƒë·ªông c·ªßa vi·ªác thay ƒë·ªïi c·∫•u h√¨nh. C·∫•u tr√∫c n√†y chuy·ªÉn ƒë·ªïi b√†i tr√¨nh b√†y tuy·∫øn t√≠nh th√†nh m·ªôt c√¥ng c·ª• h·ªçc t·∫≠p t∆∞∆°ng t√°c, phi tuy·∫øn t√≠nh, cho ph√©p ng∆∞·ªùi d√πng kh√°m ph√° th√¥ng tin theo t·ªëc ƒë·ªô v√† s·ª± quan t√¢m c·ªßa ri√™ng h·ªç, t·ª´ ƒë√≥ tƒÉng c∆∞·ªùng s·ª± hi·ªÉu bi·∫øt v√† kh·∫£ nƒÉng ghi nh·ªõ. -->
    <!-- Visualization & Content Choices: Report Info: M·ªëi quan h·ªá gi·ªØa Processing Time v√† Scheduling Delay. -> Goal: So s√°nh v√† th·ªÉ hi·ªán s·ª± thay ƒë·ªïi. -> Viz/Presentation Method: Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng ƒë·ªông (Chart.js). -> Interaction: C√°c n√∫t b·∫•m cho ph√©p ng∆∞·ªùi d√πng m√¥ ph·ªèng vi·ªác tƒÉng/gi·∫£m Processing Time v√† quan s√°t s·ª± thay ƒë·ªïi t·ª©c th√¨ c·ªßa Scheduling Delay. -> Justification: Tr·ª±c quan h√≥a m·ªëi quan h·ªá nh√¢n-qu·∫£ m·ªôt c√°ch r√µ r√†ng, gi√∫p ng∆∞·ªùi d√πng "c·∫£m nh·∫≠n" ƒë∆∞·ª£c ƒëi·ªÉm b√πng ph√°t khi h·ªá th·ªëng b·∫Øt ƒë·∫ßu qu√° t·∫£i. Library: Chart.js. Report Info: C√°c y·∫øu t·ªë c·∫•u h√¨nh (Batch Interval, Parallelism). -> Goal: S·∫Øp x·∫øp v√† cung c·∫•p th√¥ng tin chi ti·∫øt. -> Viz/Presentation Method: L∆∞·ªõi th·∫ª (HTML/Tailwind) v·ªõi c√°c bi·ªÉu t∆∞·ª£ng. -> Interaction: Nh·∫•p v√†o th·∫ª ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt. -> Justification: Gi·ªØ giao di·ªán ch√≠nh g·ªçn g√†ng v√† cho ph√©p ng∆∞·ªùi d√πng t·∫≠p trung v√†o t·ª´ng y·∫øu t·ªë m·ªôt. Library: Vanilla JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1000;
            white-space: nowrap;
            transition: opacity 0.2s;
            opacity: 0;
            transform: translateY(-10px);
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-sky-700">T·ªëi ∆∞u Spark Streaming</h1>
                </div>
                <nav class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#factors" class="text-slate-600 hover:bg-sky-100 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Y·∫øu T·ªë ·∫¢nh H∆∞·ªüng</a>
                        <a href="#metrics" class="text-slate-600 hover:bg-sky-100 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">ƒêo L∆∞·ªùng & Gi√°m S√°t</a>
                        <a href="#simulation" class="text-slate-600 hover:bg-sky-100 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Ph√≤ng Th√≠ Nghi·ªám</a>
                        <a href="#demo" class="text-slate-600 hover:bg-sky-100 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Demo & Th·ª±c H√†nh</a>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center mb-16">
            <h2 class="text-4xl font-extrabold tracking-tight text-slate-900 sm:text-5xl">Dashboard T·ªëi ∆∞u Hi·ªáu nƒÉng Spark Streaming</h2>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">M·ªôt c·∫©m nang t∆∞∆°ng t√°c gi√∫p b·∫°n hi·ªÉu r√µ c√°c y·∫øu t·ªë, ch·ªâ s·ªë v√† k·ªπ thu·∫≠t c·ªët l√µi ƒë·ªÉ x√¢y d·ª±ng c√°c ·ª©ng d·ª•ng streaming hi·ªáu qu·∫£.</p>
        </div>

        <section id="factors" class="mb-20 scroll-mt-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">C√°c Y·∫øu T·ªë ·∫¢nh H∆∞·ªüng Ch√≠nh</h3>
                <p class="mt-2 text-md text-slate-500">Hi·ªáu nƒÉng c·ªßa ·ª©ng d·ª•ng kh√¥ng ph·∫£i l√† ng·∫´u nhi√™n. N√≥ ƒë∆∞·ª£c quy·∫øt ƒë·ªãnh b·ªüi c√°c y·∫øu t·ªë c·∫•u h√¨nh v√† thi·∫øt k·∫ø c·ªët l√µi. Kh√°m ph√° t·ª´ng y·∫øu t·ªë ƒë·ªÉ hi·ªÉu r√µ t√°c ƒë·ªông c·ªßa ch√∫ng.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="factors-grid">
            </div>
        </section>

        <section id="metrics" class="mb-20 scroll-mt-20">
            <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">ƒêo L∆∞·ªùng & Gi√°m S√°t Qua Spark UI</h3>
                <p class="mt-2 text-md text-slate-500">L√Ω thuy·∫øt l√† ch∆∞a ƒë·ªß. Ch√∫ng ta c·∫ßn "th∆∞·ªõc ƒëo s·ª©c kh·ªèe" ƒë·ªÉ bi·∫øt h·ªá th·ªëng ƒëang ho·∫°t ƒë·ªông t·ªët hay kh√¥ng. Hai ch·ªâ s·ªë quan tr·ªçng nh·∫•t tr√™n Spark UI l√† Processing Time v√† Scheduling Delay.</p>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-lg">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h4 class="text-xl font-semibold mb-2 text-sky-700">Processing Time (Th·ªùi gian x·ª≠ l√Ω)</h4>
                        <p class="text-slate-600">L√† th·ªùi gian Spark c·∫ßn ƒë·ªÉ x·ª≠ l√Ω to√†n b·ªô d·ªØ li·ªáu trong m·ªôt batch. ƒê√¢y l√† ch·ªâ s·ªë cho bi·∫øt pipeline c·ªßa b·∫°n nhanh hay ch·∫≠m. <strong class="text-slate-800">Quy t·∫Øc v√†ng: Processing Time ph·∫£i lu√¥n nh·ªè h∆°n Batch Interval.</strong></p>
                    </div>
                    <div>
                        <h4 class="text-xl font-semibold mb-2 text-orange-600">Scheduling Delay (ƒê·ªô tr·ªÖ l·∫≠p l·ªãch)</h4>
                        <p class="text-slate-600">L√† th·ªùi gian m·ªôt batch ph·∫£i x·∫øp h√†ng ch·ªù tr∆∞·ªõc khi ƒë∆∞·ª£c x·ª≠ l√Ω. Ch·ªâ s·ªë n√†y th·ªÉ hi·ªán kh·∫£ nƒÉng h·ªá th·ªëng "ƒëu·ªïi k·ªãp" d√≤ng d·ªØ li·ªáu. <strong class="text-slate-800">Delay cao li√™n t·ª•c l√† d·∫•u hi·ªáu r√µ r√†ng c·ªßa vi·ªác h·ªá th·ªëng ƒëang qu√° t·∫£i.</strong></p>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
                    <div class="mt-6 text-center">
                    <p class="text-sm text-slate-500 mb-3">M√¥ ph·ªèng t√°c ƒë·ªông c·ªßa Processing Time ƒë·∫øn Scheduling Delay (v·ªõi Batch Interval = 2s)</p>
                    <div class="flex justify-center gap-4 flex-wrap">
                        <button id="btn-stable" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">K·ªãch b·∫£n ·ªîn ƒë·ªãnh (PT < BI)</button>
                        <button id="btn-warning" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">K·ªãch b·∫£n C·∫£nh b√°o (PT ‚âà BI)</button>
                        <button id="btn-overload" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">K·ªãch b·∫£n Qu√° t·∫£i (PT > BI)</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="simulation" class="mb-16 scroll-mt-20">
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">Ph√≤ng Th√≠ Nghi·ªám T∆∞∆°ng T√°c</h2>
            <p class="text-center text-gray-600 mb-10 max-w-3xl mx-auto">Ch·∫°y m·ªôt ·ª©ng d·ª•ng streaming m√¥ ph·ªèng v√† quan s√°t s·ª± thay ƒë·ªïi c·ªßa c√°c ch·ªâ s·ªë hi·ªáu nƒÉng khi b·∫°n thay ƒë·ªïi c√°c ƒëi·ªÅu ki·ªán. M·ª•c ti√™u l√† gi·ªØ cho <strong>Processing Time (ƒë∆∞·ªùng m√†u xanh)</strong> lu√¥n th·∫•p h∆°n <strong>Batch Interval (ƒë∆∞·ªùng ch·∫•m m√†u ƒë·ªè)</strong>.</p>
            
            <div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="chart-container">
                            <canvas id="streamingChart"></canvas>
                        </div>
                    </div>
                    <div class="flex flex-col justify-between">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">B·∫£ng ƒëi·ªÅu khi·ªÉn</h3>
                            <div class="space-y-3">
                                <button id="startStopBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">B·∫Øt ƒë·∫ßu m√¥ ph·ªèng</button>
                                <button id="slowTaskBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" disabled>G√¢y ngh·∫Ωn (Slow Task)</button>
                                <button id="addPartitionsBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" disabled>TƒÉng Partitions</button>
                                <button id="resetBtn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors" disabled>Reset</button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-2 mt-6">Tr·∫°ng th√°i Batch cu·ªëi c√πng</h3>
                            <div class="space-y-2 text-sm">
                                <p><strong>Batch Interval:</strong> <span id="batchIntervalValue">2000 ms</span></p>
                                <p><strong>Processing Time:</strong> <span id="procTimeValue">N/A</span></p>
                                <p><strong>Scheduling Delay:</strong> <span id="schedDelayValue">N/A</span></p>
                                <p><strong>S·ªë Partitions:</strong> <span id="partitionsValue">8</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="ui-guide" class="mb-16 scroll-mt-20"> 
            <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">Gi·∫£i m√£ Spark UI</h2> 
            <p class="text-center text-gray-600 mb-10 max-w-3xl mx-auto">Spark Web UI (c·ªïng 4040) l√† c√¥ng c·ª• gi√°m s√°t m·∫°nh m·∫Ω nh·∫•t. D∆∞·ªõi ƒë√¢y l√† c√°ch ƒë·ªçc c√°c th√¥ng s·ªë tr√™n tab "Streaming". Di chu·ªôt ho·∫∑c nh·∫•p v√†o c√°c v√πng ƒë∆∞·ª£c ƒë√°nh d·∫•u ƒë·ªÉ xem gi·∫£i th√≠ch.</p> 
            <div class="bg-white rounded-lg shadow-lg p-6 relative"> 
                <h4 class="text-lg font-bold mb-4 text-gray-700">Streaming Statistics</h4> 
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center"> 
                    <div class="bg-gray-50 p-3 rounded-lg relative" data-tooltip="T·ªïng th·ªùi gian x·ª≠ l√Ω c·ªßa t·∫•t c·∫£ c√°c batch ƒë√£ ho√†n th√†nh."> 
                        <p class="text-sm text-gray-500">Total Processing Time</p> 
                        <p class="text-2xl font-semibold">2.8 min</p> 
                    </div> 
                    <div class="bg-gray-50 p-3 rounded-lg relative" data-tooltip="T·ªïng th·ªùi gian c√°c batch ph·∫£i ch·ªù trong h√†ng ƒë·ª£i. Scheduling delay cao l√† d·∫•u hi·ªáu c·ªßa cluster qu√° t·∫£i."> 
                        <p class="text-sm text-gray-500">Total Scheduling Delay</p> 
                        <p class="text-2xl font-semibold">15.2 s</p> 
                    </div> 
                    <div class="bg-gray-50 p-3 rounded-lg relative" data-tooltip="T·ªïng s·ªë batch ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng."> 
                        <p class="text-sm text-gray-500">Completed Batches</p> 
                        <p class="text-2xl font-semibold">85</p> 
                    </div> 
                    <div class="bg-gray-50 p-3 rounded-lg relative" data-tooltip="S·ªë batch ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω t·∫°i th·ªùi ƒëi·ªÉm hi·ªán t·∫°i."> 
                        <p class="text-sm text-gray-500">Active Batches</p> 
                        <p class="text-2xl font-semibold">1</p> 
                    </div> 
                </div> 

                <div class="mt-8 overflow-x-auto"> 
                    <table class="min-w-full divide-y divide-gray-200"> 
                        <thead class="bg-gray-50"> 
                            <tr> 
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-tooltip="Th·ªùi ƒëi·ªÉm batch ƒë∆∞·ª£c t·∫°o.">Batch Time</th> 
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-tooltip="S·ªë l∆∞·ª£ng b·∫£n ghi ƒë·∫ßu v√†o c·ªßa batch.">Input Size</th> 
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-tooltip="Th·ªùi gian batch ch·ªù trong h√†ng ƒë·ª£i. ƒê√¢y l√† ch·ªâ s·ªë quan tr·ªçng ƒë·ªÉ ph√°t hi·ªán qu√° t·∫£i.">Scheduling Delay</th> 
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-tooltip="Th·ªùi gian x·ª≠ l√Ω batch. C·∫ßn theo d√µi ch·∫∑t ch·∫Ω ƒë·ªÉ ƒë·∫£m b·∫£o n√≥ lu√¥n nh·ªè h∆°n batch interval.">Processing Time</th> 
                            </tr> 
                        </thead> 
                        <tbody class="bg-white divide-y divide-gray-200"> 
                            <tr class="bg-red-50"> 
                                <td class="px-6 py-4 whitespace-nowrap">04-09-2025 14:40:10</td> 
                                <td class="px-6 py-4 whitespace-nowrap">1024 records</td> 
                                <td class="px-6 py-4 whitespace-nowrap text-red-600 font-semibold" data-tooltip="Scheduling delay cao! Cluster kh√¥ng ƒë·ªß t√†i nguy√™n ƒë·ªÉ x·ª≠ l√Ω ngay.">1890 ms</td> 
                                <td class="px-6 py-4 whitespace-nowrap text-red-600 font-semibold" data-tooltip="Processing time (2550ms) l·ªõn h∆°n batch interval! H·ªá th·ªëng ƒëang b·ªã ngh·∫Ωn.">2550 ms</td> 
                            </tr>
                            <tr class="bg-green-50">
                                <td class="px-6 py-4 whitespace-nowrap">04-09-2025 14:40:08</td> 
                                <td class="px-6 py-4 whitespace-nowrap">896 records</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">50 ms</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">1800 ms</td>
                            </tr>
                            <tr class="bg-green-50">
                                <td class="px-6 py-4 whitespace-nowrap">04-09-2025 14:40:06</td>
                                <td class="px-6 py-4 whitespace-nowrap">1024 records</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">30 ms</td>
                                <td class="px-6 py-4 whitespace-nowrap text-green-600">1950 ms</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="demo" class="scroll-mt-20">
              <div class="text-center mb-12">
                <h3 class="text-3xl font-bold text-slate-900">Demo & Th·ª±c H√†nh</h3>
                <p class="mt-2 text-md text-slate-500">T·ª´ l√Ω thuy·∫øt ƒë·∫øn th·ª±c ti·ªÖn. Xem c√°ch c√°c thay ƒë·ªïi trong c·∫•u h√¨nh v√† code ·∫£nh h∆∞·ªüng tr·ª±c ti·∫øp ƒë·∫øn c√°c ch·ªâ s·ªë tr√™n Spark UI qua c√°c k·ªãch b·∫£n demo v√† b√†i t·∫≠p th·ª±c h√†nh.</p>
              </div>
              <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="border-b border-slate-200">
                    <nav class="-mb-px flex space-x-1" id="demo-tabs">
                           <button data-tab="scenario" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-sky-600 border-sky-500">
                             K·ªãch B·∫£n Demo
                           </button>
                           <button data-tab="exercise" class="w-1/2 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-slate-500 hover:text-slate-700 hover:border-slate-300">
                             B√†i T·∫≠p Th·ª±c H√†nh
                           </button>
                    </nav>
                </div>
                <div class="p-8">
                    <div id="demo-content-scenario">
                        <div id="scenario-tabs-container" class="mb-6">
                            <div class="border-b border-gray-200">
                                <nav class="-mb-px flex justify-center space-x-8" aria-label="Tabs">
                                   <button data-scenario="baseline" class="scenario-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-sky-600 border-sky-500">Pha 1: Baseline</button>
                                   <button data-scenario="slowdown" class="scenario-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 border-transparent">Pha 2: C·ªë t√¨nh l√†m ch·∫≠m</button>
                                   <button data-scenario="optimize" class="scenario-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 border-transparent">Pha 3: T·ªëi ∆∞u Parallelism</button>
                                </nav>
                            </div>
                        </div>
                        <div id="scenario-content-container"></div>
                    </div>
                    <div id="demo-content-exercise" class="hidden"></div>
                </div>
              </div>
        </section>
    </main>

<!-- Use a template tag to prevent the browser's JS parser from trying to execute the Python code snippets -->
<template id="exercise-template">
    <div>
        <h4 class="text-xl font-semibold mb-2">Level 1: ƒêi·ªÅn v√†o ch·ªó tr·ªëng</h4>
        <p class="text-slate-600 mb-4">Ho√†n th√†nh ƒëo·∫°n code sau ƒë·ªÉ ·ª©ng d·ª•ng c√≥ th·ªÉ ch·∫°y v·ªõi Batch Interval 2 gi√¢y, th√™m ƒë·ªô tr·ªÖ 15ms/record v√† x·ª≠ l√Ω v·ªõi 4 partitions.</p>
        <div class="bg-slate-900 rounded-lg p-4 text-white font-mono text-sm overflow-x-auto">
<pre><code># Python code for the user to complete

def slow_map(x):
    # TODO: Th√™m ch·∫≠m 15ms
    <span class="text-yellow-400">__________________________</span>
    return x

# ... (spark context setup)

# TODO: T·∫°o StreamingContext v·ªõi BI = 2 gi√¢y
ssc = <span class="text-yellow-400">__________________________</span>

lines = ssc.socketTextStream("localhost", 9999)

# TODO: TƒÉng parallelism tr∆∞·ªõc x·ª≠ l√Ω
faster = lines.<span class="text-yellow-400">__________________________</span>.map(slow_map)

pairs = faster.flatMap(lambda l: l.split()).map(lambda w: (w, 1))

# TODO: reduceByKey v·ªõi 4 partitions
counts = pairs.reduceByKey(lambda a, b: a + b, numPartitions=<span class="text-yellow-400">____</span>)

# TODO: In ra 5 d√≤ng/batch
counts.<span class="text-yellow-400">________</span>(5)

ssc.start()
ssc.awaitTermination()
</code></pre>
        </div>
        <button id="show-solution-btn" class="mt-4 bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Hi·ªÉn th·ªã ƒë√°p √°n</button>
        <div id="solution-div" class="hidden mt-4 bg-green-50 p-4 rounded-lg border border-green-200">
            <h5 class="font-semibold text-green-800">ƒê√°p √°n g·ª£i √Ω:</h5>
            <ol class="list-decimal list-inside text-green-700 font-mono text-sm mt-2">
                <li>time.sleep(15 / 1000.0)</li>
                <li>StreamingContext(sc, 2)</li>
                <li>repartition(4)</li>
                <li>4</li>
                <li>pprint</li>
            </ol>
        </div>

        <h4 class="text-xl font-semibold mb-2 mt-8">Level 2: Ch·ªëng Data Skew (T√πy ch·ªçn)</h4>
        <p class="text-slate-600 mb-4">Ho√†n th√†nh ƒëo·∫°n code ƒë·ªÉ √°p d·ª•ng k·ªπ thu·∫≠t "salting" cho key "word0", gi√∫p ph√¢n t√°n t·∫£i x·ª≠ l√Ω v√† gi·∫£m th·ªùi gian ch·∫°y c·ªßa task d√†i nh·∫•t.</p>
        <div class="bg-slate-900 rounded-lg p-4 text-white font-mono text-sm overflow-x-auto">
<pre><code># Python code for the user to complete
HOT = "word0"; SALT_N = 4

# ... (streaming context and lines DStream)

words = lines.flatMap(lambda l: l.split())

# TODO: N·∫øu w == HOT, th√™m salt ng·∫´u nhi√™n
salted = words.map(lambda w: (<span class="text-yellow-400">w, 1</span>) if w != HOT else (f"{w}_{random.randint(0, SALT_N - 1)}", 1))

# TODO: reduce theo key ƒë√£ salted
part = salted.reduceByKey(lambda a,b: a+b, numPartitions=8)

# TODO: B·ªè mu·ªëi, g·ªôp l·∫°i theo key g·ªëc
unsalted = part.map(lambda kv: (kv[0].split('_')[0], kv[1])) \
    .reduceByKey(lambda a,b)

unsalted.pprint(5)
ssc.start(); ssc.awaitTermination()
</code></pre>
        </div>
    </div>
</template>
<script>
document.addEventListener('DOMContentLoaded', function () {
    /* --------- Factors Section (Cards) --------- */
    const factorsData = [
        {
            title: 'Batch Interval',
            icon: '‚è±Ô∏è',
            description: 'L√† kho·∫£ng th·ªùi gian gom d·ªØ li·ªáu th√†nh 1 batch ƒë·ªÉ x·ª≠ l√Ω. Ch·ªçn Batch Interval qu√° ng·∫Øn c√≥ th·ªÉ g√¢y backlog, trong khi qu√° d√†i l√†m tƒÉng ƒë·ªô tr·ªÖ. Quy t·∫Øc chung: <strong>Batch Interval ‚â• Processing Time</strong>.',
            details: '<ul><li class="mb-2"><strong>·∫¢nh h∆∞·ªüng:</strong> Quy·∫øt ƒë·ªãnh "nh·ªãp tim" c·ªßa ·ª©ng d·ª•ng streaming.</li><li class="mb-2"><strong>C√°ch ch·ªçn:</strong> B·∫Øt ƒë·∫ßu t·ª´ 1-2 gi√¢y v√† theo d√µi Processing Time ƒë·ªÉ ƒëi·ªÅu ch·ªânh.</li><li class="mb-2"><strong>R·ªßi ro:</strong> Batch Interval qu√° nh·ªè so v·ªõi kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác s·∫Ω khi·∫øn h·ªá th·ªëng kh√¥ng x·ª≠ l√Ω k·ªãp, d·∫´n ƒë·∫øn Scheduling Delay tƒÉng v·ªçt.</li></ul>'
        },
        {
            title: 'Parallelism (S·ªë Partition)',
            icon: '‚ÜîÔ∏è',
            description: 'Quy·∫øt ƒë·ªãnh m·ª©c ƒë·ªô x·ª≠ l√Ω song song. M·ªói partition ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi m·ªôt task tr√™n m·ªôt core. S·ªë partition ph·∫£i ƒë·ªß l·ªõn ƒë·ªÉ t·∫≠n d·ª•ng h·∫øt t√†i nguy√™n CPU c·ªßa cluster.',
            details: '<ul><li class="mb-2"><strong>·∫¢nh h∆∞·ªüng:</strong> TƒÉng parallelism gi√∫p gi·∫£m Processing Time.</li><li class="mb-2"><strong>Quy t·∫Øc ch·ªçn:</strong> S·ªë partition n√™n g·∫•p 2-4 l·∫ßn s·ªë core kh·∫£ d·ª•ng cho stage x·ª≠ l√Ω n·∫∑ng nh·∫•t.</li><li class="mb-2"><strong>R·ªßi ro:</strong> Qu√° nhi·ªÅu partition nh·ªè s·∫Ω l√†m tƒÉng overhead cho vi·ªác l·∫≠p l·ªãch v√† qu·∫£n l√Ω task.</li></ul>'
        },
        {
            title: 'Data Skew (D·ªØ li·ªáu l·ªách)',
            icon: 'üìä',
            description: 'L√† t√¨nh tr·∫°ng d·ªØ li·ªáu ph√¢n b·ªë kh√¥ng ƒë·ªìng ƒë·ªÅu gi·ªØa c√°c partition, khi·∫øn m·ªôt v√†i task ph·∫£i x·ª≠ l√Ω l∆∞·ª£ng d·ªØ li·ªáu l·ªõn b·∫•t th∆∞·ªùng v√† ch·∫°y r·∫•t l√¢u, k√©o ch·∫≠m to√†n b·ªô batch.',
            details: '<ul><li class="mb-2"><strong>Nguy√™n nh√¢n:</strong> Th∆∞·ªùng do m·ªôt s·ªë key (v√≠ d·ª•: user_id, product_id) xu·∫•t hi·ªán v·ªõi t·∫ßn su·∫•t qu√° cao.</li><li class="mb-2"><strong>Gi·∫£i ph√°p:</strong> D√πng k·ªπ thu·∫≠t "salting" - th√™m m·ªôt h·∫≠u t·ªë ng·∫´u nhi√™n v√†o c√°c key "n√≥ng" ƒë·ªÉ ph√¢n t√°n ch√∫ng ra nhi·ªÅu partition h∆°n.</li></ul>'
        },
        {
            title: 'I/O & H·ªá th·ªëng ngo√†i',
            icon: 'üíæ',
            description: 'Hi·ªáu nƒÉng kh√¥ng ch·ªâ ph·ª• thu·ªôc v√†o CPU. T·ªëc ƒë·ªô ƒë·ªçc t·ª´ ngu·ªìn (Kafka, Kinesis) ho·∫∑c ghi ra ƒë√≠ch (Database, HDFS) c√≥ th·ªÉ tr·ªü th√†nh n√∫t th·∫Øt c·ªï chai, l√†m tƒÉng Processing Time.',
            details: '<ul><li class="mb-2"><strong>V·∫•n ƒë·ªÅ:</strong> Ghi t·ª´ng record xu·ªëng DB trong m·ªôt v√≤ng l·∫∑p l√† m·ªôt anti-pattern ph·ªï bi·∫øn.</li><li class="mb-2"><strong>Gi·∫£i ph√°p:</strong> Lu√¥n s·ª≠ d·ª•ng c√°c thao t√°c ghi theo l√¥ (batch I/O), v√≠ d·ª•: d√πng `foreachPartition` ƒë·ªÉ m·ªü m·ªôt k·∫øt n·ªëi DB v√† ghi nhi·ªÅu record c√πng l√∫c. S·ª≠ d·ª•ng I/O b·∫•t ƒë·ªìng b·ªô n·∫øu c√≥ th·ªÉ.</li></ul>'
        },
        {
            title: 'Code & C·∫•u h√¨nh Runtime',
            icon: '‚öôÔ∏è',
            description: 'C√°ch vi·∫øt code v√† c√°c c·∫•u h√¨nh runtime nh∆∞ c∆° ch·∫ø serialization hay garbage collection (GC) c√≥ t√°c ƒë·ªông l·ªõn ƒë·∫øn hi·ªáu nƒÉng.',
            details: '<ul><li class="mb-2"><strong>T·ªëi ∆∞u code:</strong> Tr√°nh `collect()` kh√¥ng c·∫ßn thi·∫øt, d√πng `mapPartitions` thay `map` cho c√°c t√°c v·ª• kh·ªüi t·∫°o t·ªën k√©m.</li><li class="mb-2"><strong>T·ªëi ∆∞u runtime:</strong> D√πng Kryo Serialization thay v√¨ Java Serialization m·∫∑c ƒë·ªãnh ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô. Tinh ch·ªânh c·∫•u h√¨nh GC ƒë·ªÉ gi·∫£m thi·ªÉu th·ªùi gian "stop-the-world".</li></ul>'
        },
        {
            title: 'Backpressure',
            icon: ' ‡§™‡•ç‡§∞‡•á‡§∂‡§∞',
            description: 'M·ªôt c∆° ch·∫ø t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh t·ªëc ƒë·ªô nh·∫≠n d·ªØ li·ªáu t·ª´ ngu·ªìn ƒë·ªÉ ph√π h·ª£p v·ªõi kh·∫£ nƒÉng x·ª≠ l√Ω c·ªßa h·ªá th·ªëng, gi√∫p ngƒÉn ng·ª´a t√¨nh tr·∫°ng qu√° t·∫£i v√† s·∫≠p ·ª©ng d·ª•ng.',
            details: '<ul><li class="mb-2"><strong>C·∫•u h√¨nh:</strong> B·∫≠t b·∫±ng c·ªù `spark.streaming.backpressure.enabled=true`.</li><li class="mb-2"><strong>Ho·∫°t ƒë·ªông:</strong> Spark s·∫Ω t·ª± ƒë·ªông gi·∫£m `maxRatePerPartition` n·∫øu `Scheduling Delay` v√† `Processing Time` b·∫Øt ƒë·∫ßu tƒÉng, v√† tƒÉng l·∫°i khi h·ªá th·ªëng ·ªïn ƒë·ªãnh.</li></ul>'
        },
    ];

    const factorsGrid = document.getElementById('factors-grid');
    factorsData.forEach(factor => {
        const card = document.createElement('div');
        card.className = 'bg-white p-6 rounded-xl shadow-md hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer';
        card.innerHTML = `
            <div class="flex items-start">
                <div class="text-4xl mr-4">${factor.icon}</div>
                <div>
                    <h4 class="text-lg font-semibold mb-1">${factor.title}</h4>
                    <p class="text-slate-600 text-sm">${factor.description}</p>
                </div>
            </div>
            <div class="factor-details hidden mt-4 pt-4 border-t border-slate-200 text-sm text-slate-700">
                ${factor.details}
            </div>
        `;
        factorsGrid.appendChild(card);
        card.addEventListener('click', () => {
            card.querySelector('.factor-details').classList.toggle('hidden');
        });
    });

    /* --------- Performance Chart (Metrics Section) --------- */
    const ctx = document.getElementById('performanceChart').getContext('2d');
    let performanceChart;
    const initialLabels = Array.from({ length: 10 }, (_, i) => `Batch ${i + 1}`);
    const batchIntervalLine = Array(10).fill(2);

    function createOrUpdateChart(processingTimeData, schedulingDelayData, title) {
        if (performanceChart) performanceChart.destroy();
        performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: initialLabels,
                datasets: [
                    {
                        label: 'Processing Time (s)',
                        data: processingTimeData,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Scheduling Delay (s)',
                        data: schedulingDelayData,
                        borderColor: 'rgb(234, 88, 12)',
                        backgroundColor: 'rgba(234, 88, 12, 0.1)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Batch Interval (s)',
                        data: batchIntervalLine,
                        borderColor: 'rgb(34, 197, 94)',
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Th·ªùi gian (gi√¢y)' }
                    },
                    x: { title: { display: true, text: 'Batch theo th·ªùi gian' } }
                },
                plugins: {
                    title: { display: true, text: title, font: { size: 16 } },
                    legend: { position: 'top' }
                }
            }
        });
    }

    document.getElementById('btn-stable').addEventListener('click', () => {
        createOrUpdateChart([1.2, 1.4, 1.3, 1.5, 1.4, 1.3, 1.6, 1.5, 1.4, 1.3],
                            Array(10).fill(0.1),
                            'K·ªãch b·∫£n ·ªîn ƒë·ªãnh (PT < BI)');
    });

    document.getElementById('btn-warning').addEventListener('click', () => {
        createOrUpdateChart([1.9, 2.0, 2.1, 2.0, 1.95, 2.05, 2.0, 2.1, 1.9, 2.0],
                            [0.2, 0.3, 0.4, 0.5, 0.4, 0.6, 0.5, 0.6, 0.4, 0.5],
                            'K·ªãch b·∫£n C·∫£nh b√°o (PT ‚âà BI)');
    });

    document.getElementById('btn-overload').addEventListener('click', () => {
        createOrUpdateChart([2.5, 2.8, 3.0, 3.2, 3.1, 3.3, 3.0, 3.2, 3.1, 3.4],
                            [0.5, 0.8, 1.0, 1.2, 1.3, 1.5, 1.4, 1.6, 1.5, 1.7],
                            'K·ªãch b·∫£n Qu√° t·∫£i (PT > BI)');
    });

    createOrUpdateChart([1.4, 1.5, 1.3, 1.6, 1.4, 1.5, 1.3, 1.6, 1.5, 1.4],
                        Array(10).fill(0.1),
                        'K·ªãch b·∫£n ·ªîn ƒë·ªãnh (PT < BI)');

    /* --------- Streaming Simulation Chart --------- */
    const streamingCtx = document.getElementById('streamingChart').getContext('2d');
    let streamingChart = new Chart(streamingCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                { label: 'Processing Time (ms)', data: [], borderColor: 'rgb(59, 130, 246)', tension: 0.3 },
                { label: 'Batch Interval (ms)', data: [], borderColor: 'rgb(239, 68, 68)', borderDash: [5, 5], pointRadius: 0 }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'ms' } },
                x: { title: { display: true, text: 'Batch' } }
            }
        }
    });

    let simInterval, batchCount = 0, partitions = 8, batchInterval = 2000, slowTask = false;

    function updateSimulation() {
        batchCount++;
        let baseProc = slowTask ? 2800 : 1500;
        let procTime = baseProc * (8 / partitions);
        let delay = procTime > batchInterval ? procTime - batchInterval : 0;

        streamingChart.data.labels.push(`B${batchCount}`);
        streamingChart.data.datasets[0].data.push(procTime);
        streamingChart.data.datasets[1].data.push(batchInterval);

        document.getElementById('procTimeValue').textContent = `${procTime.toFixed(0)} ms`;
        document.getElementById('schedDelayValue').textContent = `${delay.toFixed(0)} ms`;
        document.getElementById('partitionsValue').textContent = partitions;

        streamingChart.update();
    }

    const startStopBtn = document.getElementById('startStopBtn');
    const slowTaskBtn = document.getElementById('slowTaskBtn');
    const addPartitionsBtn = document.getElementById('addPartitionsBtn');
    const resetBtn = document.getElementById('resetBtn');

    startStopBtn.addEventListener('click', () => {
        if (!simInterval) {
            simInterval = setInterval(updateSimulation, 2000);
            startStopBtn.textContent = 'D·ª´ng m√¥ ph·ªèng';
            slowTaskBtn.disabled = false;
            addPartitionsBtn.disabled = false;
            resetBtn.disabled = false;
        } else {
            clearInterval(simInterval);
            simInterval = null;
            startStopBtn.textContent = 'B·∫Øt ƒë·∫ßu m√¥ ph·ªèng';
        }
    });

    slowTaskBtn.addEventListener('click', () => { slowTask = true; });
    addPartitionsBtn.addEventListener('click', () => { partitions += 4; });
    resetBtn.addEventListener('click', () => {
        clearInterval(simInterval);
        simInterval = null;
        streamingChart.data.labels = [];
        streamingChart.data.datasets[0].data = [];
        streamingChart.data.datasets[1].data = [];
        streamingChart.update();
        batchCount = 0; partitions = 8; slowTask = false;
        startStopBtn.textContent = 'B·∫Øt ƒë·∫ßu m√¥ ph·ªèng';
        document.getElementById('procTimeValue').textContent = 'N/A';
        document.getElementById('schedDelayValue').textContent = 'N/A';
        document.getElementById('partitionsValue').textContent = '8';
    });

    /* --------- Tooltip cho UI Guide --------- */
    const tooltipDiv = document.createElement('div');
    tooltipDiv.className = 'tooltip';
    document.body.appendChild(tooltipDiv);

    document.querySelectorAll('[data-tooltip]').forEach(el => {
        el.addEventListener('mouseenter', e => {
            tooltipDiv.textContent = el.dataset.tooltip;
            tooltipDiv.style.left = e.pageX + 'px';
            tooltipDiv.style.top = (e.pageY - 30) + 'px';
            tooltipDiv.style.opacity = 1;
        });
        el.addEventListener('mouseleave', () => { tooltipDiv.style.opacity = 0; });
    });

    /* --------- Demo Tabs --------- */

    const demoTabs = document.getElementById('demo-tabs');
    const demoContents = {
        scenario: document.getElementById('demo-content-scenario'),
        exercise: document.getElementById('demo-content-exercise')
    };

    demoTabs.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const tabName = e.target.dataset.tab;
            demoTabs.querySelectorAll('button').forEach(btn => {
                btn.className = 'w-1/2 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-slate-500 hover:text-slate-700 hover:border-slate-300';
            });
            e.target.className = 'w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm text-sky-600 border-sky-500';

            Object.values(demoContents).forEach(content => content.classList.add('hidden'));
            demoContents[tabName].classList.remove('hidden');
        }
    });

    const scenarioContent = {
        baseline: `
            <h4 class="text-xl font-semibold mb-4 text-center">Pha 1: Baseline - H·ªá th·ªëng ch·∫°y ·ªïn ƒë·ªãnh</h4>
            <p class="text-center text-slate-600 mb-6">V·ªõi c·∫•u h√¨nh ban ƒë·∫ßu (BI=2s, 4 partitions), h·ªá th·ªëng x·ª≠ l√Ω tho·∫£i m√°i l∆∞·ª£ng d·ªØ li·ªáu ƒë·∫øn.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <h5 class="font-semibold mb-2">C·∫•u h√¨nh:</h5>
                    <ul class="list-disc list-inside text-sm text-slate-700">
                        <li>Batch Interval: <strong>2 gi√¢y</strong></li>
                        <li>Master: <strong>local[4]</strong></li>
                        <li>Partitions: <strong>4</strong></li>
                        <li>Thao t√°c: ƒê·∫øm t·ª´ ƒë∆°n gi·∫£n.</li>
                    </ul>
                    <h5 class="font-semibold mb-2 mt-4">K·ª≥ v·ªçng tr√™n UI:</h5>
                    <div class="bg-green-50 text-green-800 p-4 rounded-lg text-sm">
                        <p><strong>Processing Time:</strong> ·ªîn ƒë·ªãnh, < 2s</p>
                        <p><strong>Scheduling Delay:</strong> ‚âà 0 ms</p>
                    </div>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                    <p class="font-mono text-sm text-slate-500 mb-2">// Mockup Bi·ªÉu ƒë·ªì Spark UI</p>
                    <div class="w-full h-48 bg-white rounded flex items-end border border-slate-200 p-2">
                        <div class="w-full h-1/3 bg-blue-200 rounded-t-sm" title="Processing Time"></div>
                        <div class="w-full h-0 bg-orange-200 rounded-t-sm" title="Scheduling Delay"></div>
                    </div>
                </div>
            </div>`,
        slowdown: `
            <h4 class="text-xl font-semibold mb-4 text-center">Pha 2: C·ªë t√¨nh l√†m ch·∫≠m - G√¢y ra qu√° t·∫£i</h4>
            <p class="text-center text-slate-600 mb-6">Ta th√™m m·ªôt l·ªánh \`time.sleep()\` v√†o code ƒë·ªÉ m√¥ ph·ªèng m·ªôt t√°c v·ª• x·ª≠ l√Ω n·∫∑ng, khi·∫øn Processing Time tƒÉng v·ªçt.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <h5 class="font-semibold mb-2">Thay ƒë·ªïi:</h5>
                    <div class="bg-red-50 text-red-800 p-3 rounded-lg text-sm font-mono mb-4">
                        time.sleep(20 / 1000.0) # Th√™m sleep
                    </div>
                    <h5 class="font-semibold mb-2">K·ª≥ v·ªçng tr√™n UI:</h5>
                    <div class="bg-red-50 text-red-800 p-4 rounded-lg text-sm">
                        <p><strong>Processing Time:</strong> TƒÉng v·ªçt, > 2s</p>
                        <p><strong>Scheduling Delay:</strong> B·∫Øt ƒë·∫ßu tƒÉng l√™n li√™n t·ª•c</p>
                    </div>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                    <p class="font-mono text-sm text-slate-500 mb-2">// Mockup Bi·ªÉu ƒë·ªì Spark UI</p>
                    <div class="w-full h-48 bg-white rounded flex items-end border border-slate-200 p-2">
                        <div class="w-full h-4/5 bg-blue-200 rounded-t-sm" title="Processing Time"></div>
                        <div class="w-full h-2/5 bg-orange-200 rounded-t-sm" title="Scheduling Delay"></div>
                    </div>
                </div>
            </div>`,
        optimize: `
            <h4 class="text-xl font-semibold mb-4 text-center">Pha 3: T·ªëi ∆∞u - TƒÉng Parallelism</h4>
            <p class="text-center text-slate-600 mb-6">B·∫±ng c√°ch tƒÉng s·ªë partitions, ch√∫ng ta c√≥ th·ªÉ ph√¢n t√°n c√¥ng vi·ªác x·ª≠ l√Ω, gi·∫£m Processing Time v√† ƒë∆∞a h·ªá th·ªëng v·ªÅ tr·∫°ng th√°i ·ªïn ƒë·ªãnh.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <h5 class="font-semibold mb-2">Thay ƒë·ªïi:</h5>
                    <div class="bg-green-50 text-green-800 p-3 rounded-lg text-sm font-mono mb-4">
                        .repartition(8) # TƒÉng parallelism
                    </div>
                    <h5 class="font-semibold mb-2">K·ª≥ v·ªçng tr√™n UI:</h5>
                    <div class="bg-green-50 text-green-800 p-4 rounded-lg text-sm">
                        <p><strong>Processing Time:</strong> Gi·∫£m xu·ªëng, < 2s</p>
                        <p><strong>Scheduling Delay:</strong> Tr·ªü l·∫°i ‚âà 0 ms</p>
                    </div>
                </div>
                <div class="bg-slate-100 p-4 rounded-lg">
                    <p class="font-mono text-sm text-slate-500 mb-2">// Mockup Bi·ªÉu ƒë·ªì Spark UI</p>
                    <div class="w-full h-48 bg-white rounded flex items-end border border-slate-200 p-2">
                        <div class="w-full h-1/2 bg-blue-200 rounded-t-sm" title="Processing Time"></div>
                        <div class="w-full h-1/5 bg-orange-200 rounded-t-sm" title="Scheduling Delay"></div>
                    </div>
                </div>
            </div>`
    };

    const scenarioTabs = document.querySelectorAll('.scenario-tab');
    const scenarioContentContainer = document.getElementById('scenario-content-container');

    scenarioTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            scenarioTabs.forEach(t => {
                t.classList.remove('text-sky-600', 'border-sky-500');
                t.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'border-transparent');
            });
            tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'border-transparent');
            tab.classList.add('text-sky-600', 'border-sky-500');
            scenarioContentContainer.innerHTML = scenarioContent[tab.dataset.scenario];
        });
    });

    // Initial content
    scenarioTabs[0].click();

    const exerciseTemplate = document.getElementById('exercise-template').content;
    const exerciseContainer = document.getElementById('demo-content-exercise');
    exerciseContainer.appendChild(exerciseTemplate.cloneNode(true));

    const showSolutionBtn = document.getElementById('show-solution-btn');
    const solutionDiv = document.getElementById('solution-div');
    if (showSolutionBtn) {
        showSolutionBtn.addEventListener('click', () => {
            solutionDiv.classList.toggle('hidden');
            if (solutionDiv.classList.contains('hidden')) {
                showSolutionBtn.textContent = 'Hi·ªÉn th·ªã ƒë√°p √°n';
            } else {
                showSolutionBtn.textContent = '·∫®n ƒë√°p √°n';
            }
        });
    }

    // Tooltip logic for the new section
    const tooltipElement = document.createElement('div');
    tooltipElement.className = 'tooltip';
    document.body.appendChild(tooltipElement);

    const interactiveElements = document.querySelectorAll('[data-tooltip]');

    interactiveElements.forEach(element => {
        let timer;
        element.addEventListener('mouseenter', (e) => {
            const tooltipText = element.getAttribute('data-tooltip');
            if (tooltipText) {
                clearTimeout(timer);
                timer = setTimeout(() => {
                    tooltipElement.textContent = tooltipText;
                    tooltipElement.style.opacity = '1';
                    tooltipElement.style.left = `${e.clientX + 15}px`;
                    tooltipElement.style.top = `${e.clientY + 15}px`;
                }, 300); // Delay to prevent flickering
            }
        });
        element.addEventListener('mouseleave', () => {
            clearTimeout(timer);
            tooltipElement.style.opacity = '0';
        });
        element.addEventListener('mousemove', (e) => {
             // Update position on mousemove for a smoother feel
            tooltipElement.style.left = `${e.clientX + 15}px`;
            tooltipElement.style.top = `${e.clientY + 15}px`;
        });
    });
});
</script>

</body>
</html>
